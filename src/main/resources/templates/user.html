<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>유저 상세 정보</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .user-details-table, .problem-table {
      width: 100%;
    }
    .user-details-table th, .user-details-table td,
    .problem-table th, .problem-table td {
      padding: 10px;
      vertical-align: middle;
      text-align: left;
    }
    .user-details-table th {
      width: 30%;
      background-color: #f8f9fa;
    }
    .user-details-table td, .problem-table td {
      font-weight: bold;
    }
    .user-type {
      font-weight: bold;
      color: #007bff; /* 기본 색상, 필요에 따라 동적 변경 가능 */
    }
    .problem-table th {
      background-color: #e9ecef;
    }
  </style>
</head>
<body>

<div class="container mt-5">
  <h1 class="mb-4">유저 상세 정보</h1>
  <div class="card mb-4">
    <div class="card-body">
      <table class="table user-details-table">
        <tr>
          <th>ID</th>
          <td th:text="${user.id}">1</td>
        </tr>
        <tr>
          <th>이름</th>
          <td th:text="${user.name}">User Name</td>
        </tr>
        <tr>
          <th>이메일</th>
          <td th:text="${user.email}">user@example.com</td>
        </tr>
        <tr>
          <th>식별자</th>
          <td th:text="${user.identifier}">identifier</td>
        </tr>
        <tr>
          <th>유저 유형</th>
          <td class="user-type" th:text="${user.type}">GUEST</td>
        </tr>
        <tr>
          <th>Created At</th>
          <td th:text="${@dateFormatter.format(user.createdAt)}">2024년 08월 20일 18시 32분 51초</td>
        </tr>
        <tr>
          <th>Updated At</th>
          <td th:text="${@dateFormatter.format(user.updatedAt)}">2024년 08월 20일 18시 32분 51초</td>
        </tr>
      </table>

      <!-- Buttons aligned in the same row -->
      <div class="d-flex mt-3">
        <a th:href="@{/admin/users}" class="btn btn-primary me-2">유저 목록 창으로 이동</a>
        <button class="btn btn-danger" onclick="deleteUser()">유저 삭제</button>
      </div>
    </div>
  </div>
  <br></br>

  <!-- 문제 목록 및 총 개수 표시 -->
  <h2 class="mb-4">작성한 문제 목록</h2>
  <p class="mb-4">총 문제 수: <span th:text="${#lists.size(problems)}">0</span></p>

  <div class="card">
    <div class="card-body">
      <table class="table problem-table">
        <thead>
        <tr>
          <th>ID</th>
          <th>보정 이미지</th>
          <th>문제 이미지</th>
          <th>정답 이미지</th>
          <th>풀이 이미지</th>
          <th>메모</th>
          <th>출처</th>
          <th>푼 날짜</th>
          <th>생성일</th>
          <th>수정일</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="problem : ${problems}">
          <td th:text="${problem.problemId}">1</td>
          <td>
            <a th:href="@{'/admin/user/image/view?url=' + ${problem.processImageUrl}}">
              <img th:src="${problem.processImageUrl}" alt="Process Image" class="img-thumbnail" style="max-width: 100px;">
            </a>
          </td>
          <td>
            <a th:href="@{'/admin/user/image/view?url=' + ${problem.problemImageUrl}}">
              <img th:src="${problem.problemImageUrl}" alt="Problem Image" class="img-thumbnail" style="max-width: 100px;">
            </a>
          </td>
          <td>
            <a th:href="@{'/admin/user/image/view?url=' + ${problem.answerImageUrl}}">
              <img th:src="${problem.answerImageUrl}" alt="Answer Image" class="img-thumbnail" style="max-width: 100px;">
            </a>
          </td>
          <td>
            <a th:href="@{'/admin/user/image/view?url=' + ${problem.solveImageUrl}}">
              <img th:src="${problem.solveImageUrl}" alt="Solve Image" class="img-thumbnail" style="max-width: 100px;">
            </a>
          </td>
          <td th:text="${problem.memo}">Memo</td>
          <td th:text="${problem.reference}">Reference</td>
          <td th:text="${@dateFormatter.format(problem.solvedAt)}">2024년 08월 20일 18시 32분 51초</td>
          <td th:text="${@dateFormatter.format(problem.createdAt)}">2024년 08월 20일 18시 32분 51초</td>
          <td th:text="${@dateFormatter.format(problem.updateAt)}">2024년 08월 20일 18시 32분 51초</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Bootstrap JS (Optional) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript for deleting the user -->
<script>
  function deleteUser() {
    if (confirm("정말 유저를 삭제하시겠습니까?")) {
      var userId = [[${user.id}]]; // Thymeleaf syntax to insert the user ID
      fetch(`/admin/user/${userId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => {
                if (response.ok) {
                  alert("유저를 성공적으로 삭제했습니다.");
                  window.location.href = "/admin/users";
                } else {
                  alert("유저 삭제에 실패했습니다.");
                }
              })
              .catch(error => {
                console.error("삭제 중 에러가 발생했습니다:", error);
                alert("유저 삭제에 실패했습니다.");
              });
    }
  }

  function openImage(imageUrl) {
    var imgWindow = window.open("", "_blank", "toolbar=no,scrollbars=no,resizable=yes");
    imgWindow.document.write(`
      <html>
        <head>
          <title>Image</title>
        </head>
        <body style="margin:0;display:flex;align-items:center;justify-content:center;background-color:black;">
          <img src="${imageUrl}" style="width:100%; height:auto;">
        </body>
      </html>
    `);
    imgWindow.document.close();
  }
</script>
</body>
</html>